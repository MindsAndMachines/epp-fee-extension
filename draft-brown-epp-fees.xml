<?xml version="1.0" encoding="us-ascii"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
	<!-- One method to get references from the online citation libraries.
	There has to be one entity for each item to be referenced. 
	An alternate method (rfc include) is described in the references. -->
	
	<!ENTITY I-D.narten-iana-considerations-rfc2434bis SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.narten-iana-considerations-rfc2434bis.xml">
	
	<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
	
	<!ENTITY RFC3688 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3688.xml">

	<!ENTITY RFC3915 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3915.xml">
	
	<!ENTITY RFC5730 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5730.xml">

	<!ENTITY RFC5731 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5731.xml">

]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs), 
please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
(Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space 
(using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<?rfc comments="yes" ?>
<!-- show cref output -->
<?rfc inline="yes" ?>
<!-- inline cref output -->
<!-- end of list of popular I-D processing instructions -->

<rfc category="exp" docName="draft-brown-epp-fees" ipr="trust200902">
  <!-- category values: std, bcp, info, exp, and historic
ipr values: full3667, noModification3667, noDerivatives3667
you can add the attributes updates="NNNN" and obsoletes="NNNN" 
they will automatically be output with "(if approved)" -->
  <!-- ***** FRONT MATTER ***** -->

  <front>
    <title abbrev="Registry Fee Extension for the EPP">Registry Fee Extension
    for the Extensible Provisioning Protocol</title>

    <author fullname="Gavin Brown" initials="G" surname="Brown">
      <organization>CentralNic Group plc</organization>
      <address>
        <postal>
          <street>35-39 Moorgate</street>
          <city>London</city>
          <region>England</region>
          <code>EC2R 6AR</code>
          <country>GB</country>
        </postal>
        <phone>+44 20 33 88 0600</phone>
        <email>gavin.brown@centralnic.com</email>
        <uri>https://www.centralnic.com</uri>
      </address>
    </author>

    <date month="November" year="2013" />

    <!-- Meta-data Declarations -->
    <area>Applications</area>
    <workgroup>Internet Engineering Task Force</workgroup>
    <keyword>EPP, XML</keyword>
    <abstract><t>This document describes an Extensible Provisioning Protocol
    (EPP) extension mapping for registry fees.</t></abstract>
  </front>

  <middle>

    <section title="Introduction">
      <t>Historically, domain name registries have applied a simple fee
      structure for billable transactions, namely a basic unit price applied to
      domain &lt;create&gt;, &lt;renew&gt;, &lt;transfer&gt; and RGP restore
      commands. Given the relatively small number of EPP servers that EPP
      clients have been required to connect to, it has generally been the case
      that client operators have been able to obtain details of these fees
      out-of-band by contacting the server operators.</t>

      <t>Given the imminent expansion of the DNS namespace, and the
      proliferation of novel business models, it is now desirable to provide a
      method for EPP clients to query EPP servers for the fees associated with
      certain commands and specific objects.</t>

      <t>This document describes an extension mapping for version 1.0 of the 
      <xref target="RFC5730">Extensible Provisioning Protocol (EPP)</xref>. This
      EPP mapping provides a mechanism by which EPP clients may query the fees
      associated with various billable transactions.</t>

      <section title="Conventions Used in This Document">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in 
        <xref target="RFC2119">RFC 2119</xref>.</t>

        <t>XML is case sensitive. Unless stated otherwise, XML specifications
        and examples provided in this document MUST be interpreted in the
        character case presented in order to develop a conforming
        implementation.</t>

        <t>"fee" is used as an abbreviation for
        "urn:ietf:params:xml:ns:fee-0.1". The XML namespace prefix "fee" is
        used, but implementations MUST NOT depend on it and instead employ a
        proper namespace-aware XML parser and serializer to interpret and output
        the XML documents.</t>

        <t>The XML namespace prefix above contains a version number,
        specifically "0.1". This version number will increment with successive
        versions of this document, and will reach 1.0 if and when this document
        is published as an RFC. This permits clients to distinguish which
        version of the extension a server has implemented.</t>

      </section>
    </section>

    <section title="EPP Command Mapping">

      <t>A detailed description of the EPP syntax and semantics can be found in
      <xref target="RFC5730" />.</t>

      <section title="EPP Query Commands">
        <t>This extension does not add any elements to the EPP &lt;info&gt;,
        &lt;poll&gt;, or &lt;transfer&gt; commands or responses.</t>

        <section title="EPP &lt;check&gt; Command">
          <t>This extension defines additional elements for the EPP
          &lt;check&gt; command.</t>

	  <t>The command frame MAY contain an &lt;extension&gt; element which
	  MAY contain one or more child &lt;fee:check&gt; elements with the
	  following child elements:</t>

	  <t><list style="symbols">
	    <t>A &lt;domain:name&gt; element that contains the domain name.</t>
	    <t>A &lt;fee:currency&gt; element that contains the currency the fee
	    is charged in. This must be a three-character currency code from
	    <xref target="ISO 4217"/>.</t>
	    <t>A &lt;fee:action&gt; element identifying the command. This MUST
	    be one of the following:
	      <list>
                <t>"create" indicating a &lt;domain:create&gt; command;</t>
                <t>"renew" indicating a &lt;domain:renew&gt; command;</t>
                <t>"transfer" indicating a &lt;domain:transfer&gt; command;</t>
                <t>"restore" indicating a RGP restore command as described in
                 <xref target="RFC3915" />.</t>
	      </list>
	    </t>
	    <t>A &lt;fee:period&gt; element that contains the number of units to
	    be added to the registration period of the domain object.</t> 
	  </list></t>

	  <t>Example &lt;check&gt; command:</t>

	  <figure><artwork><![CDATA[
C: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
C: <epp xmlns="urn:ietf:params:xml:ns:epp-1.0">
C:   <command>
C:     <check>
C:       <domain:check
C:        xmlns:domain="urn:ietf:params:xml:ns:domain-1.0">
C:         <domain:name>example.com</domain:name>
C:       </domain:check>
C:     </check>
C:     <extension>
C:       <fee:check xmlns:fee="urn:ietf:params:xml:ns:fee-0.1">
C:         <fee:domain>example.com</fee:domain>
C:         <fee:currency>USD</fee:currency>
C:         <fee:action>create</fee:action>
C:         <fee:period unit="y">1</fee:period>
C:       </fee:check>
C:       <fee:check xmlns:fee="urn:ietf:params:xml:ns:fee-0.1">
C:         <fee:domain>example.net</fee:domain>
C:         <fee:currency>EUR</fee:currency>
C:         <fee:action>transfer</fee:action>
C:         <fee:period unit="y">2</fee:period>
C:       </fee:check>
C:     </extension>
C:     <clTRID>ABC-12345</clTRID>
C:   </command>
C: </epp>
]]></artwork></figure>

        <t>When the server receives a &lt;check&gt; command that includes the
        extension elements described above, its response MUST contain an
        &lt;extension&gt; element, which MUST contain a child
        &lt;fee:chkData&gt; element for each &lt;fee:check&gt; element contained
        in the command. The &lt;fee:chkData&gt; MUST contain the following child
        elements:</t>

        <t><list style="symbols">
	  <t>A &lt;domain:name&gt; element that contains a domain name which
	  matches the name in the corresponding &lt;fee:check&gt; element.</t>

	  <t>A &lt;fee:currency&gt; element that contains same currency code
	  that appeared in the corresponding &lt;fee:check&gt; element.</t>

	  <t>A &lt;fee:action&gt; element that contains same action
	  that appeared in the corresponding &lt;fee:check&gt; element.</t>

          <t>A &lt;fee:period&gt; element that contains same unit
	  that appeared in the corresponding &lt;fee:check&gt; element.</t>

	  <t>A &lt;fee:fee&gt; element that contains the fee associated with the
	  specified transaction.</t>


        </list></t>

        <t>Example &lt;check&gt; response:</t>

	  <figure><artwork><![CDATA[
S: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
S: <epp xmlns="urn:ietf:params:xml:ns:epp-1.0">
S:   <response>
S:     <result code="1000">
S:       <msg>Command completed successfully</msg>
S:     </result>
S:     <resData>
S:       <domain:chkData
S:        xmlns:domain="urn:ietf:params:xml:ns:domain-1.0">
S:         <domain:cd>
S:           <domain:name avail="1">example.com</domain:name>
S:         </domain:cd>
S:         <domain:cd>
S:           <domain:name avail="0">example.net</domain:name>
S:           <domain:reason>In use</domain:reason>
S:         </domain:cd>
S:       </domain:chkData>
S:     </resData>
S:     <extension>
S:        <fee:chkData xmlns:fee="urn:ietf:params:xml:ns:fee-0.1">
S:          <fee:domain>example.com</fee:domain>
S:          <fee:currency>USD</fee:currency>
S:          <fee:action>create</fee:action>
S:          <fee:period unit="y">1</fee:period>
S:          <fee:fee>10.00</fee:fee>
S:        </fee:chkData>
S:        <fee:chkData xmlns:fee="urn:ietf:params:xml:ns:fee-0.1">
S:          <fee:domain>example.net</fee:domain>
S:          <fee:currency>EUR</fee:currency>
S:          <fee:action>transfer</fee:action>
S:          <fee:period unit="y">2</fee:period>
S:          <fee:fee>5.00</fee:fee>
S:        </fee:chkData>
S:     </extension>
S:     <trID>
S:       <clTRID>ABC-12345</clTRID>
S:       <svTRID>54322-XYZ</svTRID>
S:     </trID>
S:   </response>
S: </epp>
]]></artwork></figure>
        </section>

      </section>

      <section title="EPP Transform Commands"><t>This extension does not add any
      elements to the EPP &lt;create&gt;, &lt;delete&gt;, &lt;renew&gt;, or
      &lt;transfer&gt; commands or responses.</t></section>

      <section title="Formal Syntax">
        <t>An EPP object mapping is specified in XML Schema notation. The formal
        syntax presented here is a complete schema representation of the object
        mapping suitable for automated validation of EPP XML instances.</t>

      <t>Copyright (c) 2013 IETF Trust and the persons identified as authors
      of the code. All rights reserved.</t>

      <t>Redistribution and use in source and binary forms, with or without
      modification, are permitted provided that the following conditions are
      met:</t>

      <t><list style="symbols">
          <t>Redistributions of source code must retain the above copyright
          notice, this list of conditions and the following disclaimer.</t>

          <t>Redistributions in binary form must reproduce the above copyright
          notice, this list of conditions and the following disclaimer in the
          documentation and/or other materials provided with the
          distribution.</t>

          <t>Neither the name of Internet Society, IETF or IETF Trust, nor the
          names of specific contributors, may be used to endorse or promote
          products derived from this software without specific prior written
          permission.</t>
        </list></t>

      <t>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
      "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
      LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
      PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
      OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
      EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
      PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
      PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
      LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
      NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
      SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</t>

<figure><artwork><![CDATA[
BEGIN
<?xml version="1.0" encoding="utf-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
  xmlns:fee="urn:ietf:params:xml:ns:fee-0.1"
  xmlns:eppcom="urn:ietf:params:xml:ns:eppcom-1.0"
  xmlns:domain="urn:ietf:params:xml:ns:domain-1.0"
  targetNamespace="urn:ietf:params:xml:ns:fee-0.1"
  elementFormDefault="qualified">

  <import namespace="urn:ietf:params:xml:ns:eppcom-1.0" />
  <import namespace="urn:ietf:params:xml:ns:domain-1.0" />

  <annotation>
    <documentation>Extensible Provisioning Protocol v1.0 domain name
    extension schema for fee information.</documentation>
  </annotation>

  <!--
  Child elements found in EPP commands.
  -->
  <element name="check" type="fee:checkType" />
  <element name="chkData" type="fee:chkDataType" />

  <!--
    client <check> command
  -->
  <complexType name="checkType">
    <sequence>
      <element name="domain" type="eppcom:labelType" />
      <element name="currency" type="fee:currencyType" />
      <element name="action" type="fee:actionType" />
      <element name="period" type="domain:periodType" />
    </sequence>
  </complexType>

  <!--
    server <check> result
  -->
  <complexType name="chkDataType">
    <sequence>
      <element name="domain" type="eppcom:labelType" />
      <element name="currency" type="fee:currencyType" />
      <element name="action" type="fee:actionType" />
      <element name="period" type="domain:periodType" />
      <element name="fee" type="fee:feeType" />
    </sequence>
  </complexType>

  <!--
    common types
  -->
  <simpleType name="currencyType">
    <restriction base="string">
      <pattern value="[A-Z]{3}" />
    </restriction>
  </simpleType>

  <simpleType name="actionType">
    <restriction base="string">
      <enumeration value="create" />
      <enumeration value="renew" />
      <enumeration value="transfer" />
      <enumeration value="restore" />
    </restriction>
  </simpleType>

  <simpleType name="feeType">
    <restriction base="decimal" />
  </simpleType>
</schema>
END]]></artwork></figure>

      </section>

    </section>

    <section anchor="Security" title="Security Considerations"><t>The mapping
    extensions described in this document do not provide any security services
    beyond those described by <xref target="RFC5730">EPP</xref>, the <xref
    target="RFC5731">EPP domain name mapping</xref>, and protocol layers used by
    EPP. The security considerations described in these other specifications
    apply to this specification as well.</t></section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document uses URNs to describe XML namespaces and XML schemas
      conforming to a registry mechanism described in <xref target="RFC3688" />.
      Two URI assignments were requested and have been registered by the
      IANA.</t>
      <t>Registration request for the digital signature namespace:</t>
      <t>URI: urn:ietf:params:xml:ns:fee-0.1</t>
      <t>Registrant Contact: See the "Author's Address" section of this
      document.</t>
      <t>XML: None. Namespace URIs do not represent an XML specification.</t>
      <t>Registration request for the EPP fee XML schema:</t>
      <t>URI: urn:ietf:params:xml:ns:fee-0.1</t>
      <t>Registrant Contact: See the "Author's Address" section of this
      document.</t>
      <t>XML: See the "Formal Syntax" section of this document.</t>
    </section>

  </middle>

  <back>
    <!-- References split into informative and normative -->
    <!-- There are 2 ways to insert reference entries from the citation libraries:
1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
(for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

Both are cited textually in the same manner: by using xref elements.
If you use the PI option, xml2rfc will, by default, try to find included files in the same
directory as the including file. You can also define the XML_LIBRARY environment variable
with a value containing a set of directories to search.  These can be either in the local
filing system or remote ones accessed by http (http://domain/dir/... ).-->
    <references title="Normative References">
      &RFC2119;
      &RFC3688;
      &RFC3915;
      &RFC5730;
      &RFC5731;

      <reference anchor="ISO 4217" target="ISO 4217">
          <front>
              <title>ISO 4217:2008, Codes for the representation of currencies
              and funds</title>
              <author>
                  <organization>ISO</organization>
              </author>
              <date year="2008" />
          </front>
      </reference>

    </references>
  </back>
</rfc>
